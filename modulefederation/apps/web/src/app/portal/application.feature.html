<div class="application">
  <!-- toolbar -->

  <mat-toolbar class="toolbar">
    <mat-toolbar-row>
      <command-button command="save"></command-button>

      <!-- TODO --->
      <command-button command="addApplication"></command-button>
      <command-button command="addVersion"></command-button>
    </mat-toolbar-row>
  </mat-toolbar>

  <div class="view">

    <!-- tree -->

    <application-tree class="tree" [applications]="applications"  [microfrontendVersions]="microfrontendVersions" (onSelectionChange)="selectNode($event)"></application-tree>

    <!-- content area. -->

    <div class="content">

      <!-- microfrontend version -->

      <mat-tab-group  *ngIf="selectedMicrofrontendVersion">
        <mat-tab label="General">
          <div class="application">
         
              <mat-label>Name</mat-label>
              <div>{{selectedMicrofrontendVersion.id}}</div>
          </div>
        </mat-tab>

        <mat-tab label="Configuration">
          <configuration-tree [configuration]="configurationData" [inherits]="inheritedConfigurationData" (onAdd)="addItem($event)"(onAddFolder)="addFolder($event)"  (onDelete)="deleteItem($event)" (onChanged)="changed($event)"></configuration-tree>
        </mat-tab>
      </mat-tab-group>

      <!-- microfrontend instance -->

      <mat-tab-group  *ngIf="selectedMicrofrontendInstance">
        <mat-tab label="General">
          <div class="application">
         
              <mat-label>Name</mat-label>
              <div>{{selectedMicrofrontendInstance.uri}}</div>
          </div>
        </mat-tab>

        <mat-tab label="Configuration">
          <configuration-tree [configuration]="configurationData" [inherits]="inheritedConfigurationData" (onAdd)="addItem($event)"(onAddFolder)="addFolder($event)"  (onDelete)="deleteItem($event)" (onChanged)="changed($event)"></configuration-tree>
        </mat-tab>
      </mat-tab-group>

      <!-- application -->

      <mat-tab-group  *ngIf="selectedApplication">
        <mat-tab label="General">
          <div class="application">
         
              <mat-label>Name</mat-label>
              <div>{{selectedApplication.name}}</div>
          </div>
        </mat-tab>

        <mat-tab label="Configuration">
          <configuration-tree [configuration]="configurationData" [inherits]="inheritedConfigurationData" (onAdd)="addItem($event)"(onAddFolder)="addFolder($event)"  (onDelete)="deleteItem($event)" (onChanged)="changed($event)"></configuration-tree>
        </mat-tab>
      </mat-tab-group>

      <!-- version -->
      
      <div class="version" *ngIf="selectedVersion">
        <!-- general -->
            
        <div class="general">
              <mat-label>Name</mat-label>
              <div>{{selectedVersion.version}}</div>
        </div>

        <mat-divider></mat-divider>
      
        <div class="configuration">
            <mat-label>Configuration</mat-label>
            <configuration-tree [configuration]="configurationData" [inherits]="inheritedConfigurationData" (onAdd)="addItem($event)"(onAddFolder)="addFolder($event)"  (onDelete)="deleteItem($event)" (onChanged)="changed($event)"></configuration-tree>
        </div>
        
        <mat-divider></mat-divider>

        <div class="microfrontends">
            <mat-label>Microfrontends</mat-label>
            <div class="table">

              <!-- table -->
              
              <table class="mat-elevation-z0" mat-table [dataSource]="dataSource">
                <ng-container [matColumnDef]="col.key" *ngFor="let col of columnsSchema">
                  <!-- header -->

                  <th mat-header-cell *matHeaderCellDef [ngSwitch]="col.key">
                    <span *ngSwitchCase="'isSelected'"></span> 
                    <!--TODO WTF span *ngSwitchCase="'isSelected'">
                      <mat-checkbox
                        (change)="selectAll($event)"
                        [checked]="isAllSelected()"
                        [indeterminate]="!isAllSelected() && isAnySelected()"
                      ></mat-checkbox>
                    </span-->
                    <span *ngSwitchDefault>{{ col.label }}</span>
                  </th>

                  <td mat-cell *matCellDef="let element">
                    <!-- non edit -->

                    <div [ngSwitch]="col.type" *ngIf="!element.isEdit">
                      <ng-container *ngSwitchCase="'isSelected'">
                        <mat-checkbox
                          (change)="element.isSelected = $event.checked"
                          [checked]="element.isSelected"
                        ></mat-checkbox>
                      </ng-container>

                      <div class="btn-edit" *ngSwitchCase="'isEdit'">
                        <button mat-icon-button (click)="element.isEdit = !element.isEdit">
                          <mat-icon>edit</mat-icon>
                        </button>

                        <button mat-icon-button class="button-remove" (click)="removeRow(element)">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </div>

                      <!--span *ngSwitchCase="'date'">
                        {{ element[col.key] | date: 'mediumDate' }}
                      </span-->

                      <span *ngSwitchDefault>
                        {{ element.data[col.key] }}
                      </span>
                    </div>

                    <!-- edit mode -->

                    <div [ngSwitch]="col.type" *ngIf="element.isEdit">
                      <div *ngSwitchCase="'isSelected'"></div>
                      <!-- done -->
                      
                      <div class="btn-edit" *ngSwitchCase="'isEdit'">
                        <button mat-icon-button (click)="finishEdit(element)" >
                          <mat-icon>done</mat-icon>
                        </button>

                        <!-- [disabled]="disableSubmit(element)" -->
                      </div>

                      <mat-form-field class="form-input" *ngSwitchCase="'mfe'">
                        <input
                          matInput
                          [required]="col.required"
                          type="text"
                          [(ngModel)]="element.data[col.key]"
                          [suggestionProvider]="suggestionProvider"
                          (change)="inputHandler($event, element, col.key)"
                        />
                      </mat-form-field>

                      <mat-form-field class="form-input" *ngSwitchDefault>
                        <input
                          matInput
                          [required]="col.required"
                          [pattern]="col.pattern"
                          [type]="col.type"
                          [(ngModel)]="element.data[col.key]"
                          (change)="inputHandler($event, element, col.key)"
                        />
                      </mat-form-field>
                    </div>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
              </table>

              <!-- + button -->

              <div>
                <!--button
                  class="button-remove-rows"
                  mat-button
                  (click)="removeSelectedRows()"
                >
                  Remove Rows
                </button-->
                <button class="button-add-row" mat-icon-button (click)="addRow()">
                  <mat-icon>add_box</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
